<!--
 Copyright 2015 the original author or authors.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<!--
  Design considerations for pair programming with Kenny Bastini:
  - API call for returning Wikidata statements to populate off-canvas menus for Ada Lovelace (Q7259):
    https://www.wikidata.org/w/api.php?action=wbgetentities&ids=Q7259&languages=en&props=labels|sitelinks|descriptions|claims
    [] Perhaps create a REST service for this for three reasons:
       - Simplify/reduce verbosity of the response
       - Fill out relationships not present in the response
       - Potentially do some caching
    [?] Either way, will need to populate a graph of objects in the web client, and I have only had experience populating
       a single POJO at that level.  What would be the best approach?

  - Wikidata API call for returning information about properties, for example this one returns info for P1 - P10 in english.
  https://www.wikidata.org/w/api.php?action=wbgetentities&ids=P1|P2|P3|P4|P5|P6|P7|P8|P9|P10&languages=en
  There are 2300+ properties, and it is possible to get 50 at a time.
  [] Perhaps create the following REST service that returns the name of a property given a property number (e.g. "P1477")
     and language (e.g. "en" and "pt-br").  Properties used could be cached in the web client, rather than loading and
     caching all of them.
  http://wikibrowserservice.cfapps.io/propertyName?id=P1477&language=en
  The service could cache the necessary information when it starts up, by using the Wikidata REST call shown above that
  gets names for properties.


  [] Create REST services for the following:
     - Given a Wikipedia subject name (e.g. Ada_Lovelace), return the Wikidata ID (e.g. Q7259)
     - Given a Wikidata ID (e.g. Q7259), return the Wikipedia subject name (e.g. Ada_Lovelace)
  [?] Should these REST services be in a separate microservice from other REST services that returns the name of a property?
-->

<!doctype html>

<html class="no-js" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WikiBrowser</title>
  <link rel="stylesheet" href="css/foundation.css" />
  <script src="js/vendor/modernizr.js"></script>
</head>

<body>

  <div class="off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">
      <nav class="tab-bar">
        <section class="middle tab-bar-section">
          <h1 class="title">Ada Lovelace</h1>
        </section>

        <section class="right-small">
          <a class="right-off-canvas-toggle menu-icon" href="#"><span></span></a>
        </section>
      </nav>

      <aside class="right-off-canvas-menu">
        <ul class="off-canvas-list" id="offCanvasList">
          <!--li><label>WikiData statements</label></li>

          <li class="has-submenu"><a href="#"><i>occupation:</i></a>
            <ul class="right-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="Mathematician.html">mathematician</a></li>
              <li><a href="#">programmer</a></li>
              <li><a href="#">poet</a></li>
              <li><a href="#">computer scientist</a></li>
              <li><a href="#">engineer</a></li>
            </ul>
          </li>
          <li><a href="Charles_Babbage.html"><i>influenced by:</i><br/>Charles Babbage</a></li>

          <li class="has-submenu"><a href="#"><i>children:</i></a>
            <ul class="right-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="#">Byron King-Noel, Viscount Ockham</a></li>
              <li><a href="#">Anne Blunt, 15th Baroness Wentworth</a></li>
              <li><a href="#">Ralph King-Milbanke, 2nd Earl of Lovelace</a></li>
            </ul>
          </li>
          <li><a href="#"><i>mother:</i><br/>Anne Isabella Byron </a></li>
          <li><a href="#"><i>father:</i><br/>Lord Byron</a></li>
          <li><a href="#"><i>sister:</i><br/>Allegra Byron</a></li>
          <li><a href="#"><i>instance of:</i><br/>human</a></li-->
        </ul>
      </aside>

      <section class="main-section">
        <iframe id="wikipediaInnerFrame" src="https://en.m.wikipedia.org/wiki/Earth" frameborder="0" scrolling="yes" width="1000"></iframe>

      </section>

      <a class="exit-off-canvas"></a>

    </div>
  </div>

  <script>
    window.addEventListener('load', function() {

      $.ajax({ // ajax call starts
            url: '/claims', // JQuery loads serverside.php
            data: 'id=Q2&lang=en', // Send value of the clicked button
            dataType: 'json', // Choosing a JSON datatype
          })
          .done(function(data) { // Variable data contains the data we get from serverside
            //$('#offCanvasList').html(''); // Clear #wines div
            populateOffCanvasList(data)
          })
          .error(function(err) {
            alert("error: " + err);
          });

      $( "#wikipediaInnerFrame" ).attr("width",window.innerWidth - 0).attr("height",window.innerHeight - 60);
    } );

    function populateOffCanvasList(resp) {
      //$('#offCanvasList').append("<li><label>WikiData Statements</label></li>");
      for (var cIdx in resp.claim) {
        if (resp.claim[cIdx].val.length == 1) {
          $('#offCanvasList').append("<li><a href='#'><label>" + resp.claim[cIdx].prop.label + ":</label><br/>" + resp.claim[cIdx].val[0].label + "</a></li>");
          //$('#offCanvasList').append("<li><a href='#'><i>" + resp.claim[cIdx].prop.label + ":</i><br/>" + resp.claim[cIdx].val[0].label + "</a></li>");
        }
        else {
          $('#offCanvasList').append("<li><label>" + resp.claim[cIdx].prop.label + ":</label></li>");
          //$('#offCanvasList').append("<li class='has-submenu'><a href='#'><i>" + resp.claim[cIdx].prop.label + ":</i></a>");
          //$('#offCanvasList').append("  <ul class='right-submenu'>");
          //$('#offCanvasList').append("    <li class='back'><a href='#'>Back</a></li>");
          var vals = resp.claim[cIdx].val;
          for (var vIdx in vals) {
            $('#offCanvasList').append("  <li><a href='#'>" + vals[vIdx].label + "</a></li>");
          }
          $('#offCanvasList').append("  </ul>");
          $('#offCanvasList').append("</li>");
        }
      }
      //$('#offCanvasList').append("</ul>");
    }
  </script>


  <script src="js/vendor/jquery.js"></script>
  <script src="js/foundation.min.js"></script>
  <script>
    $(document).foundation();
  </script>
  <script>
    // Throttled resize function
    $(window).on('resize', Foundation.utils.throttle(function(e){
      $( "#wikipediaInnerFrame" ).attr("width",window.innerWidth - 0).attr("height",window.innerHeight - 60);
    }, 300));
  </script>

</body>
</html>
